<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>HEX 8 байт: заголовок + таблица 11x5 (мобильная версия)</title>
    <style>
        /* СБРОС И БАЗОВЫЕ СТИЛИ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: #f2f5fa;
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 12px 10px;
        }

        .card {
            width: 100%;
            max-width: 480px; /* оптимальная ширина для мобильных */
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 36px;
            box-shadow: 0 20px 40px rgba(0, 20, 40, 0.25);
            padding: 22px 18px;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* ЗАГОЛОВОК */
        h1 {
            font-size: 1.85rem;
            font-weight: 700;
            letter-spacing: -0.03em;
            color: #0b2542;
            margin-bottom: 6px;
            line-height: 1.2;
        }

        .badge {
            display: inline-block;
            background: #dfe8f3;
            border-radius: 40px;
            padding: 6px 14px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #1e3a5f;
            margin-bottom: 16px;
        }

        /* ПОЛЕ ВВОДА */
        .input-group {
            background: #ffffffd9;
            border-radius: 28px;
            padding: 18px 16px;
            margin-bottom: 22px;
            box-shadow: inset 0 1px 4px #ffffff, 0 10px 18px -12px #183858;
        }

        .label-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1e3b5c;
            font-size: 0.95rem;
        }

        .hex-field {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        #hexInput {
            flex: 1;
            min-width: 200px;
            background: #f0f6ff;
            border: 2px solid #b7cee8;
            border-radius: 50px;
            padding: 16px 18px;
            font-family: 'Courier New', monospace;
            font-size: 1.3rem;
            font-weight: 600;
            letter-spacing: 3px;
            color: #002856;
            outline: none;
            transition: 0.2s;
        }

        #hexInput:focus {
            border-color: #1f5fcf;
            box-shadow: 0 0 0 3px #1f5fcf40;
            background: #ffffff;
        }

        #parseBtn {
            background: #152f4b;
            border: none;
            border-radius: 50px;
            padding: 0 22px;
            font-weight: 700;
            font-size: 1.1rem;
            color: white;
            cursor: pointer;
            transition: 0.15s;
            box-shadow: 0 8px 14px -8px #0a1f33;
            border: 1px solid #5f8bc9;
            min-width: 100px;
            white-space: nowrap;
        }

        #parseBtn:active {
            background: #0c223a;
            transform: scale(0.97);
        }

        .hint {
            font-size: 0.8rem;
            color: #40668a;
            margin-top: 10px;
            background: #e3ecf6;
            padding: 8px 14px;
            border-radius: 26px;
        }

        /* ЗАГОЛОВОК 9 БИТ */
        .section-title {
            font-weight: 700;
            font-size: 1.3rem;
            color: #112f4b;
            margin: 18px 0 10px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-container {
            background: #e9f0fa;
            border-radius: 32px;
            padding: 18px 12px;
            border: 1px solid #c7daf0;
        }

        .bits-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .bit-tile {
            background: white;
            border-radius: 18px;
            box-shadow: 0 4px 10px #b1c8e3;
            min-width: 58px;
            text-align: center;
            padding: 12px 0;
            flex: 0 1 auto;
            border: 1px solid #aac2df;
        }

        .bit-tile.header-tile {
            background: #d5e8ff;
            border: 2px solid #2463cb;
        }

        .bit-value {
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            font-weight: 800;
            line-height: 1.2;
        }

        .bit-label {
            font-size: 0.7rem;
            color: #2e4b74;
        }

        .status-badge {
            display: inline-block;
            border-radius: 30px;
            padding: 5px 15px;
            font-size: 0.9rem;
            font-weight: 600;
            background: #e2ecf9;
            margin-left: 8px;
        }

        .badge-ok {
            background: #d0e9d0;
            color: #1b6b1b;
        }

        .badge-err {
            background: #ffdddd;
            color: #b12b2b;
        }

        /* ТАБЛИЦА (полностью адаптивная) */
        .table-wrapper {
            background: #e3ecf7;
            border-radius: 28px;
            padding: 12px 8px;
            margin-top: 12px;
            border: 1px solid #c1d4ec;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            min-width: 360px; /* чуть меньше, чтобы влезало */
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 6px 18px #b0cae3;
        }

        th {
            background: #1f3d61;
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
            padding: 12px 2px;
            text-align: center;
            border: 1px solid #325987;
        }

        td {
            border: 1px solid #d0ddef;
            text-align: center;
            padding: 10px 2px;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .data-1 {
            background: #dcf0ff;
            color: #093366;
        }

        .data-0 {
            background: #ffffff;
            color: #5e7b9f;
        }

        .xor-col {
            background: #e9f0fa;
            font-size: 0.8rem;
            font-weight: 500;
            color: #1a3455;
            white-space: nowrap;
        }

        /* НИЖНИЕ КАРТОЧКИ СТАТУСОВ */
        .status-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 22px;
        }

        .status-card {
            flex: 1 1 calc(50% - 10px);
            min-width: 140px;
            background: #ffffffde;
            border-radius: 26px;
            padding: 16px 12px;
            border-left: 8px solid;
            box-shadow: 0 8px 16px -12px #152f4b;
        }

        .card-title {
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 6px;
            color: #1e3f62;
        }

        .card-value {
            font-size: 1rem;
            font-weight: 600;
        }

        /* СООБЩЕНИЕ ОБ ОШИБКЕ */
        .error-message {
            background: #fce4e4;
            border-radius: 30px;
            padding: 14px 18px;
            color: #ac2c2c;
            font-weight: 600;
            margin-top: 18px;
            display: none;
            border: 2px solid #c43c3c;
        }

        /* МЕЛКИЕ ПРАВКИ ДЛЯ ОЧЕНЬ УЗКИХ ЭКРАНОВ */
        @media (max-width: 380px) {
            .card { padding: 16px 12px; }
            h1 { font-size: 1.6rem; }
            .bit-tile { min-width: 48px; }
            .bit-value { font-size: 1.7rem; }
        }
    </style>
</head>
<body>
<div class="card">
    <h1>8 байт → 9+55</h1>
    <div class="badge">заголовок 9 бит = 1 • XOR для первых 10 строк и первых 4 столбцов</div>

    <!-- Ввод HEX -->
    <div class="input-group">
        <div class="label-row">
            <span>HEX (16 символов)</span>
            <span style="color:#51799e;">пример: FFFFFFFFFF800000</span>
        </div>
        <div class="hex-field">
            <input type="text" id="hexInput" maxlength="16" value="FFFFFFFFFFFF8000" placeholder="например FFFFFFFFFF800000">
            <button id="parseBtn">OK</button>
        </div>
        <div class="hint">
            ⚡ 64 бита: первые 9 → заголовок (все 1), остальные 55 → таблица 11x5
        </div>
    </div>

    <!-- Заголовок 9 бит с проверкой на единицы -->
    <div class="section-title">
        📌 Заголовок
        <span id="headerCheck" class="status-badge">—</span>
    </div>
    <div class="header-container">
        <div id="headerBits" class="bits-grid"><!-- будет заполнено js --></div>
    </div>

    <!-- Таблица 11 строк x 5 столбцов + доп колонка для XOR строк -->
    <div class="section-title">📋 таблица 11x5</div>
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>row</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th>
                    <th style="background:#274d76;">XOR стр</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <!-- Карточки статусов (только строки 0-9 и столбцы 0-3) -->
    <div class="status-row">
        <div class="status-card" style="border-left-color: #2563eb;" id="rowStatusCard">
            <div class="card-title">✅ XOR строк (0–9)</div>
            <div class="card-value" id="rowStatusValue">—</div>
        </div>
        <div class="status-card" style="border-left-color: #8b5cf6;" id="colStatusCard">
            <div class="card-title">📊 XOR столбцов (0–3)</div>
            <div class="card-value" id="colStatusValue">—</div>
        </div>
    </div>

    <!-- Блок ошибки -->
    <div id="errorBox" class="error-message"></div>
</div>

<script>
    (function() {
        // Элементы DOM
        const hexInput = document.getElementById('hexInput');
        const parseBtn = document.getElementById('parseBtn');
        const headerBitsDiv = document.getElementById('headerBits');
        const tableBody = document.getElementById('tableBody');
        const headerCheckSpan = document.getElementById('headerCheck');
        const rowStatusValue = document.getElementById('rowStatusValue');
        const colStatusValue = document.getElementById('colStatusValue');
        const rowStatusCard = document.getElementById('rowStatusCard');
        const colStatusCard = document.getElementById('colStatusCard');
        const errorBox = document.getElementById('errorBox');

        // Инициализация: 9 карточек заголовка и 11 строк таблицы
        function initUI() {
            // Заголовок
            headerBitsDiv.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const tile = document.createElement('div');
                tile.className = 'bit-tile header-tile';
                tile.id = `hdr-${i}`;
                tile.innerHTML = `<div class="bit-value">-</div><div class="bit-label">h[${i}]</div>`;
                headerBitsDiv.appendChild(tile);
            }

            // Таблица 11x5 + добавочная колонка (XOR строк)
            tableBody.innerHTML = '';
            for (let r = 0; r < 11; r++) {
                const tr = document.createElement('tr');
                // заголовок строки
                const th = document.createElement('th');
                th.textContent = r;
                tr.appendChild(th);

                // 5 ячеек данных
                for (let c = 0; c < 5; c++) {
                    const td = document.createElement('td');
                    td.id = `cell-${r}-${c}`;
                    td.className = 'data-0';
                    td.textContent = '-';
                    tr.appendChild(td);
                }

                // ячейка для XOR строки (сравнение 4 бит с 5-м)
                const xorTd = document.createElement('td');
                xorTd.id = `rowXor-${r}`;
                xorTd.className = 'xor-col';
                xorTd.textContent = '?';
                tr.appendChild(xorTd);
                tableBody.appendChild(tr);
            }
        }

        // HEX → массив 64 бит (старший бит — индекс 0)
        function hexToBits(hexStr) {
            let clean = hexStr.trim().replace(/^0x/i, '').replace(/\s+/g, '').toUpperCase();
            if (!/^[0-9A-F]{16}$/.test(clean)) {
                throw new Error('нужно 16 hex-символов (0-9, A-F)');
            }
            const big = BigInt('0x' + clean);
            const bits = [];
            for (let i = 63; i >= 0; i--) {
                bits.push(Number((big >> BigInt(i)) & 1n));
            }
            return bits; // bits[0] = бит 63 (старший)
        }

        // Главная функция обновления
        function refresh() {
            try {
                const hexStr = hexInput.value;
                const bits = hexToBits(hexStr); // 64 элемента

                // 1. ЗАГОЛОВОК — первые 9 бит (индексы 0..8)
                let headerAllOnes = true;
                for (let i = 0; i < 9; i++) {
                    const val = bits[i];
                    const tile = document.getElementById(`hdr-${i}`);
                    if (tile) {
                        const valDiv = tile.querySelector('.bit-value');
                        if (valDiv) valDiv.textContent = val;
                        tile.style.background = val === 1 ? '#c3e0ff' : '#ffc9c9';
                    }
                    if (val !== 1) headerAllOnes = false;
                }
                headerCheckSpan.textContent = headerAllOnes ? '✅ все 1' : '❌ ошибка';
                headerCheckSpan.className = `status-badge ${headerAllOnes ? 'badge-ok' : 'badge-err'}`;

                // 2. Заполняем таблицу 11x5 битами bits[9] .. bits[63] (55 штук)
                let bitPtr = 9; // следующий после заголовка
                for (let r = 0; r < 11; r++) {
                    for (let c = 0; c < 5; c++) {
                        const cell = document.getElementById(`cell-${r}-${c}`);
                        if (cell && bitPtr < 64) {
                            const b = bits[bitPtr];
                            cell.textContent = b;
                            cell.className = b === 1 ? 'data-1' : 'data-0';
                            bitPtr++;
                        }
                    }
                }

                // 3. XOR по строкам: ТОЛЬКО ДЛЯ ПЕРВЫХ 10 СТРОК (0..9). Строка 10 не проверяется.
                let rowXorOk = true;
                for (let r = 0; r < 11; r++) {
                    // собираем 5 бит строки
                    const rowVals = [];
                    for (let c = 0; c < 5; c++) {
                        const cell = document.getElementById(`cell-${r}-${c}`);
                        rowVals.push(cell ? parseInt(cell.textContent, 10) : 0);
                    }
                    const xor4 = rowVals[0] ^ rowVals[1] ^ rowVals[2] ^ rowVals[3];
                    const bit5 = rowVals[4];
                    const xorCell = document.getElementById(`rowXor-${r}`);

                    if (r <= 9) { // проверяем первые 10
                        const match = (xor4 === bit5);
                        if (!match) rowXorOk = false;
                        if (xorCell) {
                            xorCell.textContent = `${xor4} vs ${bit5} ${match ? '✓' : '✗'}`;
                            xorCell.style.backgroundColor = match ? '#d5f0d5' : '#ffdada';
                        }
                    } else { // r === 10 последняя строка — без сравнения, просто информация
                        if (xorCell) {
                            xorCell.textContent = `${xor4} | ${bit5} (без проверки)`;
                            xorCell.style.backgroundColor = '#e3ebf5';
                            xorCell.style.fontStyle = 'italic';
                        }
                    }
                }

                rowStatusValue.innerText = rowXorOk ? '✅ верно для всех 10 строк' : '❌ несовпадение в строках 0‑9';
                rowStatusCard.style.backgroundColor = rowXorOk ? '#f2fbf2' : '#fff3f3';

                // 4. XOR по столбцам: ТОЛЬКО ДЛЯ ПЕРВЫХ 4 СТОЛБЦОВ (0..3). Столбец 4 не проверяем.
                let colXorOk = true;
                for (let c = 0; c < 4; c++) { // c = 0,1,2,3
                    const colVals = [];
                    for (let r = 0; r < 11; r++) {
                        const cell = document.getElementById(`cell-${r}-${c}`);
                        colVals.push(cell ? parseInt(cell.textContent, 10) : 0);
                    }
                    // XOR первых 10 строк (r0..r9)
                    let xor10 = 0;
                    for (let r = 0; r < 10; r++) xor10 ^= colVals[r];
                    const bit11 = colVals[10]; // 11-й бит (последняя строка)
                    const match = (xor10 === bit11);
                    if (!match) colXorOk = false;

                    // Визуально отметим последнюю ячейку столбца (row10)
                    const lastCell = document.getElementById(`cell-10-${c}`);
                    if (lastCell) {
                        lastCell.style.backgroundColor = match ? '#c9efc9' : '#ffcfcf';
                    }
                }

                // Столбец 4 (последний) не трогаем — возвращаем стандартный фон
                for (let r = 0; r < 11; r++) {
                    const cell = document.getElementById(`cell-${r}-4`);
                    if (cell) {
                        cell.style.backgroundColor = ''; // сброс
                    }
                }

                colStatusValue.innerText = colXorOk ? '✅ верно для всех 4 столбцов' : '❌ несовпадение в столбцах 0‑3';
                colStatusCard.style.backgroundColor = colXorOk ? '#f2fbf2' : '#fff3f3';

                // Скрываем ошибку
                errorBox.style.display = 'none';
            } catch (e) {
                errorBox.style.display = 'block';
                errorBox.textContent = '⚠️ ' + e.message;
                // сбросим индикаторы
                headerCheckSpan.textContent = '—';
                rowStatusValue.innerText = '—';
                colStatusValue.innerText = '—';
            }
        }

        // Старт
        initUI();

        // Обработчики
        parseBtn.addEventListener('click', refresh);
        hexInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') refresh(); });
        window.addEventListener('load', refresh);
    })();
</script>
</body>
</html>
